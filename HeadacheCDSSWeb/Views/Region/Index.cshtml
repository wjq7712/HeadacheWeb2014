@model HeadacheCDSSWeb.Models.PatBasicInfor

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Regionview.cshtml";
}
@{
    var items = new SelectList(new[]
        { 
           new SelectListItem {Text = "", Value = ""},
            new SelectListItem {Text = "男", Value = "男"},
            new SelectListItem {Text = "女", Value = "女"},
        }, "Text", "Value");
}
@{
    var diagnosis = new SelectList(new[]
        {  new SelectListItem {Text = "", Value = ""},
            new SelectListItem {Text = "很可能的偏头痛", Value = "很可能的偏头痛"},
            new SelectListItem {Text = "无先兆性偏头痛", Value = "无先兆性偏头痛"},
             new SelectListItem {Text = "先兆性偏头痛", Value = "先兆性偏头痛"},
             
             new SelectListItem {Text = "偶尔发作性紧张型头痛", Value = "偶尔发作性紧张型头痛"},
            new SelectListItem {Text = "频繁阵发性紧张型头痛", Value = "频繁阵发性紧张型头痛"},
             new SelectListItem {Text = "丛集性头痛和其他三叉自主神经痛", Value = "丛集性头痛和其他三叉自主神经痛"},
             new SelectListItem {Text = "药物滥用引起的头痛", Value = "药物滥用引起的头痛"},
            new SelectListItem {Text = "慢性偏头痛", Value = "慢性偏头痛"},
             new SelectListItem {Text = "慢性紧张型头痛", Value = "慢性紧张型头痛"},
            new SelectListItem {Text = "新发每日持续性头痛", Value = "新发每日持续性头痛"},
             new SelectListItem {Text = "其他慢性每日头痛", Value = "其他慢性每日头痛"},
              new SelectListItem {Text = "其他原发性头痛", Value = "其他原发性头痛"},
        }, "Text", "Value");
}

<div id="content" style=" display:inline">
    <div id="query">
            <h2 class="title">
                查询病人</h2>
            <div id="queryinfo">
            <ul>
                <li style=" float:left"><span>姓名</span>
                    @Html.TextBox("name")
                </li>
                <li><span>性别</span>
                    @Html.DropDownList("sex", @items)
                </li>
                <li style=" float:left"><span>就诊日期</span><input type="text" name="date" id="date" />
                </li>
                <li><span>诊断结论</span> @Html.DropDownList("diagnosis", @diagnosis)
                </li>
            </ul></div>
           <div id="btn"><p><input type="submit" value="查询病人" onclick="search()"/></p></div>    
    </div>

    <div id="sidebar">
    <table id="patientTable" class="display" cellspacing="0" width="100%">
    </table>
     <div class="pagination">
        <a href="#" class="first" data-action="first">&laquo;</a> 
        <a href="#" class="previous" data-action="previous">&lsaquo;</a>
        <input type="text" readonly="readonly" data-max-page="40" />
        <a href="#" class="next" data-action="next">&rsaquo;</a>
        <a href="#" class="last" data-action="last">&raquo;</a>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $(".pagination").hide();//隐藏
        $("#date").Zebra_DatePicker();
    });

    function search() {

        var name = $("#name").val();
        var sex = $("#sex").val();
        var date = $("#date").val();
        var diagnosis = $("#diagnosis").val();
        $.ajax({
            url: '@Url.Action("Query", "Region")',
            data: { "name": name, "sex": sex, "date": date, "diagnosis": diagnosis },
            dataType: "json",
            type: "POST"
        }).done(function (data) {
            var datasource = data;
            $("#patientTable").dataTable({
                "bDestroy": true,
                "lengthChange":false,
                "language":{
                    "lengthMenu": "显示 _MENU_ 条记录每页",
                    "zeroRecords": "找不到记录 - 抱歉",
                    "info": "当前页 _PAGE_ of _PAGES_",
                    "infoFiltered": "(从总共 _MAX_ 条记录中过滤)",
                    "infoEmpty": "没有记录",
                    "paginate": {"first": "第一页",
                                 "last":"最后一页",
                                  "next": "后一页",
                                 "previous":"前一页"
                          },
                     "search": "表内查找:"
                },                
                "data": datasource,
                "columns": [{ "title": "序号", "data": "ListID", "width": "8%" }, { "title": "姓名", "data": "Name", "width": "10%" }, { "title": "性别", "data": "Sex", "width": "8%" }, { "title": "年龄", "data": "Age", "width": "8%" }, { "title": "头痛类型", "data": "HeadacheStyle" },
                            { "title": "诊断日期", "data": "Date" },{"title": "详细信息", "data": "PatBasicInforId", "render": function (data, type, full) { return "<a href='/ViewPatRecord/Index/" + data + "'>查看</a>" } }]
            })
        });
    }

    function ListPage(e) {
        var js = e.get_response().get_object();
        alert(data);
       $(".page").find("tr").hide(); //查询到的病人姓名分页显示
       $(".pagination").show();
        $("tr:lt(6)").addClass("current").show();
        var num = Math.ceil($("tr.trow").length /5);
        // 分页插件jqPagination 
        $('.pagination').jqPagination({
            max_page: num,
            paged: function (page) {
                $(".current").hide();
                var start = (page - 1) * 5;
                for (var i = 0; i < 5; i++) {
                    $("tr.thead").addClass("current").show();   
                    $("tr.trow:eq(" + start + ")").addClass("current").show();
                    start = start + 1;
                }
                // do something with the page variable
            }
        })
    }
</script>

