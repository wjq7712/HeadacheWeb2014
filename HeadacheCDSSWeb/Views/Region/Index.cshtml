@model HeadacheCDSSWeb.Models.PatBasicInfor

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Regionview.cshtml";
}
@{
    var items = new SelectList(new[]
        { 
           new SelectListItem {Text = "", Value = ""},
            new SelectListItem {Text = "男", Value = "男"},
            new SelectListItem {Text = "女", Value = "女"},
        }, "Text", "Value");
}
@{
    var diagnosis = new SelectList(new[]
        {  new SelectListItem {Text = "", Value = ""},
           new SelectListItem {Text = "偏头痛", Value = "偏头痛"},
           new SelectListItem {Text = "偏头痛:很可能的偏头痛", Value = "很可能的偏头痛"},
           new SelectListItem {Text = "偏头痛:无先兆性偏头痛", Value = "无先兆偏头痛"},
           new SelectListItem {Text = "偏头痛:先兆性偏头痛", Value = "先兆性偏头痛"},
           new SelectListItem {Text = "偏头痛:偏头痛持续状态", Value = "偏头痛持续状态"},
         
           new SelectListItem {Text = "紧张型头痛", Value = "紧张型头痛"},
           new SelectListItem {Text = "紧张型头痛:很可能的紧张型头痛", Value = "很可能的紧张型头痛"}, 
           new SelectListItem {Text = "紧张型头痛:偶尔发作性紧张型头痛", Value = "偶尔发作性紧张型头痛"},
           new SelectListItem {Text = "紧张型头痛:频繁阵发性紧张型头痛", Value = "频繁阵发性紧张型头痛"},
           
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛", Value = "丛集性头痛和其他原发性三叉神经痛"}, 
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛:丛集性头痛", Value = "丛集性头痛"},
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛:很可能的丛集性头痛", Value = "很可能的丛集性头痛"},
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛:很可能的阵发性偏侧头痛", Value = "很可能的阵发性偏侧头痛"},
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛:SUNCT", Value = "SUNCT"},
           new SelectListItem {Text = "丛集性头痛和其他原发性三叉神经痛:很可能的SUNCT", Value = "很可能的SUNCT"},           
                   
           new SelectListItem {Text = "慢性每日头痛:慢性偏头痛", Value = "慢性偏头痛"},
           new SelectListItem {Text = "慢性每日头痛:药物滥用引起的头痛", Value = "药物滥用引起的头痛"},
           new SelectListItem {Text = "慢性每日头痛:慢性紧张型头痛", Value = "慢性紧张型头痛"},   
           new SelectListItem {Text = "慢性每日头痛:新发每日持续性头痛", Value = "新发每日持续性头痛"},
           
            new SelectListItem {Text = "颅神经痛和中枢源性面痛", Value = "颅神经痛和中枢源性面痛"},
        }, "Text", "Value");
}

<div id="content" style=" display:inline">
    <div id="query">
            <h2 class="title">
                查询病人</h2>
            <div id="queryinfo">
            <ul>
                <li style=" float:left"><span class="itemname">姓名</span>
                    @Html.TextBox("name")
                </li>
                <li><span class="itemname">性别</span>
                    @Html.DropDownList("sex", @items)
                </li>
                <li style=" float:left"><span class="itemname">就诊日期</span>
                  <div id="datetimepicker4" class="input-append">
                    <input data-format="yyyy-MM-dd" type="text" name="date" id="date"/>
                    <span class="add-on" id="add">
                      <i data-time-icon="icon-time" data-date-icon="icon-calendar">
                      </i>
                    </span>
                  </div>
                </li>
                <li><span class="itemname">诊断结论</span> @Html.DropDownList("diagnosis", @diagnosis)
                </li>
            </ul></div>
           <div id="btn"><p><input type="submit" value="查询病人" onclick="search()"/></p></div>    
    </div>

    <div id="sidebar">
    <table id="patientTable" class="display" cellspacing="0" width="100%">
    </table>
</div>

<script type="text/javascript">
    $(function () {
        $('#datetimepicker4').datetimepicker({
            pickTime: false
        });
    });

    function search() {

        var name = $("#name").val();
        var sex = $("#sex").val();
        var date = $("#date").val();
        var diagnosis = $("#diagnosis").val();
        $.ajax({
            url: '@Url.Action("Query", "Region")',
            data: { "name": name, "sex": sex, "date": date, "diagnosis": diagnosis },
            dataType: "json",
            type: "POST"
        }).done(function (data) {
            var datasource = data;
            $("#patientTable").dataTable({
                "bDestroy": true,
                "lengthChange":false,
                "language":{
                    "lengthMenu": "显示 _MENU_ 条记录每页",
                    "zeroRecords": "找不到记录 - 抱歉",
                    "info": "当前页 _PAGE_ of _PAGES_",
                    "infoFiltered": "(从总共 _MAX_ 条记录中过滤)",
                    "infoEmpty": "没有记录",
                    "paginate": {"first": "第一页",
                                 "last":"最后一页",
                                  "next": "后一页",
                                 "previous":"前一页"
                          },
                     "search": "表内查找:"
                },                
                "data": datasource,
                "columns": [{ "title": "序号", "data": "ListID", "width": "8%" }, { "title": "姓名", "data": "Name", "width": "10%" }, { "title": "性别", "data": "Sex", "width": "8%" }, { "title": "年龄", "data": "Age", "width": "8%" }, { "title": "头痛类型", "data": "HeadacheStyle" },
                            { "title": "诊断日期", "data": "Date" },{"title": "详细信息", "data": "PatBasicInforId", "render": function (data, type, full) { return "<a href='/ViewPatRecord/Index/" + data + "'>查看</a>" } }]
            })
        });
    }
</script>

